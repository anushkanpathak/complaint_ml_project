<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Complaint Categorization + Recommendations</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width:800px; }
    textarea { width: 100%; height: 120px; font-size:14px; padding:8px; }
    button { margin-top: 10px; padding: 8px 16px; font-size:14px; }
    pre { background: #f5f5f5; padding: 12px; margin-top: 15px; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>Student Complaint Categorization</h2>

  <label for="complaint">Enter your complaint:</label><br>
  <textarea id="complaint" placeholder="e.g. WiFi not working in my hostel"></textarea><br>

  <button onclick="sendComplaint()">Predict Category & Recommend</button>

  <h3>Result:</h3>
  <pre id="result">No prediction yet.</pre>

<script>
async function sendComplaint() {
  const text = document.getElementById("complaint").value.trim();
  const resultBox = document.getElementById("result");

  if (!text) {
    resultBox.textContent = "Please enter a complaint first.";
    return;
  }

  try {
    resultBox.textContent = "Working...";

    const res = await fetch("/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: text })
    });

    const data = await res.json();

    let out = "";
    out += "Input: " + text + "\n\n";
    out += "Prediction: " + data.prediction + "\n";
    out += "Confidence: " + (data.max_probability * 100).toFixed(1) + "%\n\n";

    out += "Top candidate labels:\n";
    data.top_labels.forEach(item => {
      out += `- ${item.label} (${(item.prob*100).toFixed(1)}%)\n`;
    });
    out += "\n";

    out += "Recommended actions / events:\n";
    data.recommendations.forEach((r, i) => {
      out += (i+1) + ". " + r + "\n";
    });

    resultBox.textContent = out;

  } catch (err) {
    resultBox.textContent = "Error: " + err;
  }
}
</script>

</body>
</html>
